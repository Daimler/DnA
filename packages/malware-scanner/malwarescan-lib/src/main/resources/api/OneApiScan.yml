openapi: 3.0.2
info:
  title: DNA Malware Scan as a Service.
  description: REST API uri document management. Description of all the available APIs along with request and response formats. Also provides options to try calling to execute running APIs and check
  version: 0.0.1
tags:
  - name: confidential
    description: resources with classification 'scans'
  - name: internal
    description: resources with classification 'internal'  

paths:
 /scan/upload:
  post:
   tags:
    - confidential
   summary: Uploads a new file to scan.
   description: Upload file for malware scanning.
   requestBody:
     content:
       multipart/form-data:
         schema:
           type: object
           properties:
             files:
               type: string
               format: binary
   responses:
    200: 
     description: "Returns message of succes or failure " 
     content:
       application/json:
         schema:
           $ref: "#/components/schemas/UploadScanResponseWrapperVO"
    400:
     description: "Bad Request"
     content:
       application/json:
         schema:
           $ref: "#/components/schemas/UploadScanResponseWrapperVO"
    401:
     description: "Request does not have sufficient credentials."
    403:
     description: "Request is not authorized."
    405:
     description: "Method not allowed"
    500:
     description: "Internal server error"
 
 /scan/health:
  get:
   tags:
     - confidential
   summary: "gives health of clamd instance"
   description:  "gives health of clamd instance"
   responses:
      200:
       description: "Successfully downloaded."
       content:
        application/json:
          schema:
            $ref: "#/components/schemas/GenericMessage"
      400:
       description: "Bad request"
      401:
       description: "Request does not have sufficient credentials."
      403:
       description: "Request is not authorized."
      404:
       description: "Invalid id, record not found."
      500:
       description: "Internal error"

components:
  securitySchemes:
    malware-scan:
      description: "Security definition for the whole API."
      type: apiKey
      name: x-api-key
      in: header
  schemas:   
    UploadScanResponseWrapperVO:
      type: object
      properties:
        fileDetails:
         type: array
         items:
           $ref: "#/components/schemas/FileScanDetailsVO" 
    FileScanDetailsVO:
       type: object
       properties:
         fileName:
           type: string
           description: Defines the file name
         fileSize:
           type: integer
           format: int64
           description: Defines the size of the file
         fileType:
           type: string
           description: Defines the type of the file
         scanTime:
           type: integer
           format: int64
           description: time took to scan file parts in milli seconds
         detected:
           type: boolean
           description: boolean indicating if malware if detected in file part
         errorMessage:
           type: string
           description: error while scanning file part
         hash:
           type: string
         uploadTime:
           type: integer
           format: int64
           description: time took to upload file part
    GenericMessage:
     type: object
     properties:
       success:
         type: string
       errors:
         type: array
         items: 
           $ref: "#/components/schemas/MessageDescription"
       warnings:
         type: array
         items:
           $ref: "#/components/schemas/MessageDescription"
  
    MessageDescription:
     type: object
     properties:
        message: 
          type: string
          description: "error message"